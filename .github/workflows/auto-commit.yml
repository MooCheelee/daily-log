name: Test Code Review Activity

on:
  workflow_dispatch:       # 手动触发

jobs:
  code-review:
    runs-on: ubuntu-latest

    steps:
      # 拉取仓库
      - name: Checkout repo
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GH_TOKEN }}

      # ----- 随机给 PR 进行代码审查 (30% 概率) (增加 Code Reviews) -----
      - name: Randomly add code review comment
        run: |
          RAND=$((RANDOM % 100))
          if [ $RAND -lt 30 ]; then
            # 获取第一个打开的 PR URL
            PR_URL=$(gh pr list --state open --repo $GITHUB_REPOSITORY --json url -q '.[0].url')
            if [ -n "$PR_URL" ]; then
              echo "Adding review comment to PR: $PR_URL"
              gh pr review $PR_URL --approve --body "Good work! Keep it up! 🌱"
            else
              echo "No open PR found to review."
            fi
          else
            echo "今天不进行代码审查"
          fi
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
